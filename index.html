<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì£¼ì‹ ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body {
      background: #f4f7fa;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 20px;
      display: flex; justify-content: center;
    }
    #app {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      padding: 30px 40px;
      width: 1000px;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 15px;
      font-weight: 700;
      letter-spacing: 1.5px;
    }
    #timer {
      text-align: center;
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 20px;
      font-weight: 600;
      letter-spacing: 1px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }
    thead {
      background: linear-gradient(90deg, #0052D4, #4364F7, #6FB1FC);
      color: white;
    }
    th, td {
      padding: 12px 10px;
      text-align: center;
      border-bottom: 1px solid #eee;
      font-size: 0.95rem;
      vertical-align: middle;
    }
    tbody tr:hover {
      background: #f0f8ff;
      transition: background-color 0.3s ease;
    }
    button {
      background: #4364F7;
      border: none;
      color: white;
      padding: 6px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #2a43c1;
    }
    .green {
      color: #dc3545; /* ë¹¨ê°•(ìƒìŠ¹) */
      font-weight: 700;
    }
    .red {
      color: #007bff; /* íŒŒë‘(í•˜ë½) */
      font-weight: 700;
    }
    #eventBox {
      margin-top: 25px;
      padding: 18px 25px;
      background: #e9f0ff;
      border-left: 5px solid #4364F7;
      font-size: 1.1rem;
      font-weight: 600;
      color: #2a3a8f;
      border-radius: 6px;
      min-height: 48px;
      user-select: none;
    }
    /* ì°¨íŠ¸ ë§‰ëŒ€ ê·¸ë¦¬ê¸° */
    .chart-container {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      gap: 3px;
      height: 30px;
      width: 140px;
      margin: 0 auto;
    }
    .bar {
      width: 10px;
      border-radius: 3px 3px 0 0;
    }
    .bar.up {
      background-color: #dc3545; /* ë¹¨ê°• */
    }
    .bar.down {
      background-color: #007bff; /* íŒŒë‘ */
    }
    
    #rankingContainer {
  display: none;
}



  </style>
</head>
<body>
  <div id="app">
    <h1>ì£¼ì‹ ì‹œë®¬ë ˆì´í„° (Made By ë²”ì„œ) Ver 1.11 B</h1>
    <div id="timer">ë‹¤ìŒ ì£¼ê°€ ê°±ì‹ ê¹Œì§€: <span id="timerSeconds">10</span>ì´ˆ</div>
    <button id="toggleRankingBtn" style="margin-top: 20px; padding:6px 16px; font-size:1rem; cursor:pointer;">
  ğŸ† ë­í‚¹ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°
</button>
    <div style="margin-bottom:15px; font-weight:600; font-size:1rem; color:#444;">
      í˜„ì¬ ìë³¸ê¸ˆ: <span id="capital">100,000</span>
    </div>
    <table>
      <thead>
        <tr>
          <th>ì£¼ì‹ëª…</th>
          <th>ë¶„ì•¼</th>
          <th>í˜„ì¬ê°€</th>
          <th>ë³€ë™ë¥ (%)</th>
          <th>ë³€ë™ì•¡(ì›)</th>
          <th>ë³´ìœ ìˆ˜ëŸ‰</th>
          <th>ë§¤ìˆ˜</th>
          <th>ë§¤ë„</th>
          <th>ìµœê·¼ ë³€ë™ ì°¨íŠ¸</th>
        </tr>
      </thead>
      <tbody id="stockTableBody"></tbody>
    </table>
    <div id="eventBox">ìµœê·¼ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>
<hr>

  <hr id="outerHr" style="display: none;">


<div id="rankingContainer" style="margin-top:30px; text-align: left;">
  <hr>
  <div>
    <input
      type="text"
      id="username"
      placeholder="ì´ë¦„ ì…ë ¥"
      style="padding:6px 12px; border-radius:6px; border:1px solid #ccc; font-size:1rem;" />
    <button
      onclick="saveRanking()"
      style="padding:6px 16px; font-size:1rem; margin-left:10px;">ğŸ… ë­í‚¹ ë“±ë¡</button>
  </div>

  <div id="ranking" style="max-width: 500px; margin-top: 15px;"></div>
</div>







  <script>
const firebaseConfig = {
  apiKey: "AIzaSyCAl-FzExIh2HVMLXuol5HwgPSXTbqZGNk",
  authDomain: "stockgameserver-1.firebaseapp.com",
  databaseURL: "https://stockgameserver-1-default-rtdb.firebaseio.com",
  projectId: "stockgameserver-1",
  storageBucket: "stockgameserver-1.firebasestorage.app",
  messagingSenderId: "233612874090",
  appId: "1:233612874090:web:ac09f5336c7ae09fb9d513",
 
};


firebase.initializeApp(firebaseConfig);
const db = firebase.database();



    const stocks = [
      // ì‹í’ˆê´€ë ¨
      {name:"ë¡¯ë°ì¹ ì„±", category:"ì‹í’ˆ", price: 10000, owned:0, changePercent:0, changeAmount:0, history: []},
      {name:"ì˜¤ëšœê¸°", category:"ì‹í’ˆ", price: 50000, owned:0, changePercent:0, changeAmount:0, history: []},
      {name:"ë†ì‹¬", category:"ì‹í’ˆ", price: 70000, owned:0, changePercent:0, changeAmount:0, history: []},

      // ì „ì/ë°˜ë„ì²´ê´€ë ¨
      {name:"ì‚¼ì„±ì „ì", category:"ì „ì/ë°˜ë„ì²´", price: 100000, owned:0, changePercent:0, changeAmount:0, history: []},
      {name:"SKí•˜ì´ë‹‰ìŠ¤", category:"ì „ì/ë°˜ë„ì²´", price: 90000, owned:0, changePercent:0, changeAmount:0, history: []},
      {name:"LGì „ì", category:"ì „ì/ë°˜ë„ì²´", price: 80000, owned:0, changePercent:0, changeAmount:0, history: []},

      // ë³´í—˜ê´€ë ¨
      {name:"ì‚¼ì„±ìƒëª…", category:"ë³´í—˜", price: 120000, owned:0, changePercent:0, changeAmount:0, history: []},
      {name:"í•œí™”ìƒëª…", category:"ë³´í—˜", price: 85000, owned:0, changePercent:0, changeAmount:0, history: []},
      {name:"êµë³´ìƒëª…", category:"ë³´í—˜", price: 70000, owned:0, changePercent:0, changeAmount:0, history: []}
    ];

    let capital = 100000;

    const stockTableBody = document.getElementById("stockTableBody");
    const capitalElem = document.getElementById("capital");
    const eventBox = document.getElementById("eventBox");
    const timerSecondsElem = document.getElementById("timerSeconds");

    function formatNumber(num) {
      return num.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
    }

    function randomPercent(min, max) {
      return Math.random() * (max - min) + min;
    }

function getCustomRandomChange() {
  const rand = Math.random() * 100;
  let percent = 0;

  if (rand < 10) {
    percent = randomPercent(12, 20) * -1; // 10% ê¸‰ë½
  } else if (rand < 22) {
    percent = randomPercent(6, 10) * -1; // 12% ì¤‘ê°„ í•˜ë½
  } else if (rand < 35) {
    percent = randomPercent(2, 5) * -1; // 13% ì†Œí­ í•˜ë½
  } else if (rand < 60) {
    percent = randomPercent(1, 4); // 25% ì†Œí­ ìƒìŠ¹
  } else if (rand < 85) {
    percent = randomPercent(5, 8); // 25% ì¤‘ê°„ ìƒìŠ¹
  } else {
    percent = randomPercent(9, 15); // 15% ê¸‰ë“±
  }

  return percent;
}




    function updateStocks() {
      stocks.forEach(stock => {
        let changePercent = getCustomRandomChange();

        if (eventEffect[stock.category]) {
          changePercent += eventEffect[stock.category];
          if (changePercent < -100) changePercent = -100;
        }

        stock.changePercent = changePercent;

        const changeAmount = Math.floor(stock.price * (changePercent / 100));
        stock.changeAmount = changeAmount;

        let newPrice = stock.price + changeAmount;
        if (newPrice < 100) newPrice = 100;
        stock.price = newPrice;

        // ìµœê·¼ ë³€ë™ ê¸°ë¡ ë°°ì—´ì— ì €ì¥ (ìµœëŒ€ 10ê°œ ìœ ì§€)
        stock.history.push(changePercent);
        if (stock.history.length > 10) stock.history.shift();
      });

      // ì´ë²¤íŠ¸ ì˜í–¥ ì´ˆê¸°í™”
      for (let key in eventEffect) {
        eventEffect[key] = 0;
      }
    }

    function renderStocks() {
      stockTableBody.innerHTML = "";
      stocks.forEach((stock, idx) => {
        const tr = document.createElement("tr");

        const priceStr = formatNumber(stock.price);
        const changePercentStr = stock.changePercent.toFixed(2);
        const changeAmountStr = formatNumber(stock.changeAmount);

        const changeClass = stock.changePercent > 0 ? "green" : (stock.changePercent < 0 ? "red" : "");

        tr.innerHTML = `
          <td>${stock.name}</td>
          <td>${stock.category}</td>
          <td>${priceStr} ì›</td>
          <td class="${changeClass}">${changePercentStr}%</td>
          <td class="${changeClass}">${changeAmountStr} ì›</td>
          <td>${stock.owned}</td>
          <td><button ${capital < stock.price ? "disabled" : ""} data-idx="${idx}" data-action="buy">ë§¤ìˆ˜</button></td>
          <td><button ${stock.owned === 0 ? "disabled" : ""} data-idx="${idx}" data-action="sell">ë§¤ë„</button></td>
          <td>
            <div class="chart-container" title="ìµœê·¼ 10íšŒ ë³€ë™ë¥ ">
              ${stock.history.map(pct => {
                const height = Math.min(Math.abs(pct), 20) * 1.5; // ìµœëŒ€ ë†’ì´ 30px (20*1.5)
                const cls = pct > 0 ? "bar up" : "bar down";
                return `<div class="${cls}" style="height:${height}px" ></div>`;
              }).join('')}
            </div>
          </td>
        `;

        stockTableBody.appendChild(tr);
      });
    }

    function updateCapital() {
      capitalElem.textContent = formatNumber(capital) + " ì›";
    }

    stockTableBody.addEventListener("click", e => {
      if (e.target.tagName !== "BUTTON") return;
      const idx = Number(e.target.getAttribute("data-idx"));
      const action = e.target.getAttribute("data-action");
      const stock = stocks[idx];

      if (action === "buy") {
        if (capital >= stock.price) {
          stock.owned++;
          capital -= stock.price;

        }
      } else if (action === "sell") {
        if (stock.owned > 0) {
          stock.owned--;
          capital += stock.price;

        }

      }
      updateCapital();
      renderStocks();
    });

    // ì´ë²¤íŠ¸ ê´€ë ¨
    const events = [
      // ì‹í’ˆ ì´ë²¤íŠ¸
      {category:"ì‹í’ˆ", textUp:"ì‹í’ˆ ì•ˆì „ ê¸°ì¤€ ê°•í™”, ì‹í’ˆì£¼ ê°•ì„¸!", textDown:"ì‹í’ˆ ì›ìì¬ ê°€ê²© ê¸‰ë“±, ì‹í’ˆì£¼ ì•½ì„¸!"},
      // ì „ì/ë°˜ë„ì²´ ì´ë²¤íŠ¸
      {category:"ì „ì/ë°˜ë„ì²´", textUp:"ì „ìê³µí•™ì— ìƒˆë¡œìš´ ê¸°ìˆ  ë°œê²¬!", textDown:"ì „ìê³µí•™ í­ë°œ ìœ„í—˜ ëŒ€ë‘!"},
      // ë³´í—˜ ì´ë²¤íŠ¸
      {category:"ë³´í—˜", textUp:"ë³´í—˜ ì‚°ì—… ê·œì œ ì™„í™”, ë³´í—˜ì£¼ ìƒìŠ¹!", textDown:"ë³´í—˜ê¸ˆ ì§€ê¸‰ ê¸‰ì¦, ë³´í—˜ì£¼ í•˜ë½!"}
    ];
    let eventEffect = {
      "ì‹í’ˆ": 0,
      "ì „ì/ë°˜ë„ì²´": 0,
      "ë³´í—˜": 0
    };

    function triggerEvent() {
      const event = events[Math.floor(Math.random()*events.length)];
      const up = Math.random() < 0.5;
      const impactPercent = 20;
      if (up) {
        eventEffect[event.category] = impactPercent;
        eventBox.textContent = event.textUp;
      } else {
        eventEffect[event.category] = -impactPercent;
        eventBox.textContent = event.textDown;
      }
    }

    // íƒ€ì´ë¨¸ ì´ˆê¸°í™” ë° ê°±ì‹ 
    let secondsLeft = 10;
    function updateTimer() {
      secondsLeft--;
      if (secondsLeft < 0) {
        secondsLeft = 10;
        updateStocks();
        renderStocks();
        updateCapital();
      }
      timerSecondsElem.textContent = secondsLeft;
    }

    // ì´ë²¤íŠ¸ 3ë¶„ë§ˆë‹¤ ì‹¤í–‰
    setInterval(triggerEvent, 60000);

    // 10ì´ˆë§ˆë‹¤ ì£¼ê°€ ê°±ì‹ , í™”ë©´ ê°±ì‹ 
    setInterval(() => {
      updateStocks();
      renderStocks();
      updateCapital();
      secondsLeft = 10;
    }, 10000);

    // 1ì´ˆë§ˆë‹¤ íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
    setInterval(updateTimer, 1000);

    // ì´ˆê¸° ë Œë”ë§
    renderStocks();
    updateCapital();

function getTopInvestmentCategory() {
  const categoryTotals = {};

  stocks.forEach(stock => {
    const totalValue = stock.owned * stock.price;
    if (!categoryTotals[stock.category]) categoryTotals[stock.category] = 0;
    categoryTotals[stock.category] += totalValue;
  });

  // ìµœëŒ€ê°’ì„ ê°€ì§€ëŠ” ì¹´í…Œê³ ë¦¬ ì¶”ì¶œ
  let topCategory = "ì—†ìŒ";
  let maxValue = 0;

  for (const [category, value] of Object.entries(categoryTotals)) {
    if (value > maxValue) {
      maxValue = value;
      topCategory = category;
    }
  }

  return topCategory;
}




 function saveToFirebaseRanking(username) {
  const topCategory = getTopInvestmentCategory();
  db.ref("rankings/" + username).set({
    name: username,
    capital: capital,
    category: topCategory
  }, (error) => {
    if (error) {
      alert("ë“±ë¡ ì‹¤íŒ¨: " + error);
    } else {
      alert("ë­í‚¹ì— ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
    }
  });
}





function renderRankingFromFirebase() {
  db.ref("rankings").orderByChild("capital").limitToLast(10).on("value", (snapshot) => {
    const data = [];
    snapshot.forEach(child => {
      data.push(child.val());
    });

    // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    data.sort((a, b) => b.capital - a.capital);

    const rankDiv = document.getElementById("ranking");
    rankDiv.innerHTML = `
      <h3 style="margin-bottom: 12px; color:#222;">ğŸ† ë­í‚¹ TOP 10</h3>
      <ul style="list-style: none; padding: 0; margin: 0;">
        ${data.map((r, i) => `
          <li style="background: #f5f7ff; border-left: 4px solid #4364F7; border-radius: 6px; padding: 10px 14px; margin-bottom: 8px; color: #333; font-weight: 500;">
            <strong style="margin-right: 10px;">${i + 1}ìœ„</strong> ${r.name} â€” ğŸ’° ${formatNumber(r.capital)} ì›
            <div style="font-size: 0.9rem; color:#666;">ğŸ“Š ìµœëŒ€ íˆ¬ì ë¶„ì•¼: <strong>${r.category || "ì—†ìŒ"}</strong></div>
          </li>
        `).join("")}
      </ul>
    `;
  });
}






function saveRanking() {
  const name = document.getElementById("username").value.trim();
  if (name === "") return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");

  if (name === "pleaseresetã‚") {
    db.ref("rankings").remove();
    alert("ë­í‚¹ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
    return;
  }

  db.ref("rankings/" + name).once("value").then(snapshot => {
    if (snapshot.exists()) {
      alert("ì´ë¯¸ ë“±ë¡ëœ ì´ë¦„ì…ë‹ˆë‹¤!");
    } else {
      saveToFirebaseRanking(name);
    }
  });
}
const rankingContainer = document.getElementById("rankingContainer");
const toggleBtn = document.getElementById("toggleRankingBtn");





const outerHr = document.querySelector('body > hr');
if (outerHr) outerHr.style.display = "none"; // ìµœì´ˆì— ìˆ¨ê¹€

rankingContainer.style.display = "none";
if (outerHr) outerHr.style.display = "none";
toggleBtn.textContent = "ğŸ† ë­í‚¹ ë³´ì´ê¸°";

toggleBtn.addEventListener("click", () => {
  const isHidden = rankingContainer.style.display === "none";

  rankingContainer.style.display = isHidden ? "block" : "none";
  if (outerHr) outerHr.style.display = isHidden ? "block" : "none";
  toggleBtn.textContent = isHidden ? "ğŸ† ë­í‚¹ ìˆ¨ê¸°ê¸°" : "ğŸ† ë­í‚¹ ë³´ì´ê¸°";
});


renderRankingFromFirebase(); // ì´ˆê¸° ì‹¤í–‰


  </script>
</body>
</html>
